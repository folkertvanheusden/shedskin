# Shedskin Examples

75 programs that work with Shed Skin 0.9.6 (python 3.8+).

This `examples` folder includes an example runner script which provides automated builds of examples using both shedskin's builtin methods and CMake.

## Example Overview

In the following overview, each example is in its own folder of the same name

```
lines  name                 description                     notes
(sloccount)

    84 ant.py               TSP approximation
   327 amaze.py             maze generator/solver
   125 astar.py             a-star algorithm                shedskin -e astar && make && python astar_main.py
   415 bh.py                barnes-hut force calculation
    54 brainfuck.py         brainfuck interpreter
  3600 c64_main.py          commodore 64 emulator           cd c64; shedskin -boe c64 && make; cd ..
                                                            python c64_main.py --tape=intkarat.t64
                                                            load
                                                            run
   321 chess.py             chess engine
   105 dijkstra.py          dijkstra's algorithm
    80 dijkstra2.py         bidirectional dijkstra search
   220 chaos.py             chaosgame-like fractals
   290 chull.py             3D convex hull
    65 circle.py            circle packing animation        shedskin -e circle && make
                                                            python circle_main.py (drag circles with mouse)
   665 doom.py              WAD rendering engine            shedskin -e render && make
                                                            python doom.py
   147 fysphun.py           physics animation               shedskin -e fysphun && make
                                                            python fysphun_main.py (drag points with mouse)
    92 genetic.py           genetic algorithm
   168 genetic2.py          another genetic algorithm
   300 go.py                go player (monte carlo/UCT)     shedskin -b go && make
                                                            ./go
                                                            (see DISCO for details)
   250 gs_main.py           wolfenstein-like 3d engine      cd Gh0stenstein; shedskin -bwe world_manager && make
                                                            cd ..; python gs_main.py
  1539 hq2x.py              pixel art scaling               (linecount misleading, autogenerated code)
    74 life.py              conway's game of life
   218 pylife.py            hashlife-based game of life     shedskin -e pylife && make
                                                            python pylife_main.py
   186 linalg.py            linear algebra
   190 LZ2.py               Lempel-Ziv compressor
   174 ac_encode.py         Arithmetic coding compressor
   130 adatron.py           Adatron SVM with polynomial kernel
   222 block.py             Huffman block compressor
   329 kanoodle.py          Knuth's dancing links
   118 kmeanspp.py          K-means++ Clustering
   270 loop.py              Havlak loop recognition algorithm
    26 mandelbrot.py        mandelbrot fractal
   108 mandelbrot2_main.py  interactive mandelbrot fractal  shedskin -e mandelbrot2 && make && python mandelbrot2_main.py
   223 mastermind_main.py   mastermind against comp         cd mm; shedskin -e mastermind && make
                                                            cd ..; python mastermind_main.py
   117 mastermind2.py       mastermind strategies
    49 minpng.py            uncompressed PNG encoder
 1,201 msp_ss.py            serial bootstrap loader         shedskin -Llib msp_ss.py
   482 mwmatching.py        maximum weighted matching algorithm
   101 nbody.py             planet body physics
   154 neural1.py           back-prop neural network        python neural1.py --test
   109 neural2.py           back-prop neural network
    78 oliva2.py            sea shell patterns
    95 othello.py           othello player
    80 pisang.py            satisfiability solver
   272 pygmy.py             raytracer
   276 yopyra.py            raytracer
   195 mao.py               raytracer (ao benchmark)        see comments in top
                                                            shedskin -r mao (fast random number generator)
   462 minilight.py         advanced raytracer              shedskin -r minilight (fast random number generator)
                            (triangle primitives, octree spatial index)
   208 path_tracing.py      path tracing raytracer          shedskin -r path_tracing
   392 plcfrs.py            natural language parser
  1543 pygasus_main.py      NES emulator                    shedskin -be pygasus && make
                                                            python pygasus_main.py mario_bros.nes
  1050 pylot_main.py        multiprocessing raytracer       cd pylot; shedskin -boe SimpleGeometry && make; cd ..
                                                            python pylot_main.py
   181 pystone.py           standard benchmark
  1181 quameon              quantum monte carlo algorithms  cd quameon; shedskin sto_atom
   286 richards.py          standard benchmark
   469 rdb.py               iPod shuffle programmer         see comments in top
    82 rsync.py             rsync algorithm                 see comments in top
   846 rubik.py             rubik solver
    78 rubik2.py            thistlethwaite rubik solver
   259 sat.py               conflict-driven satisfiability solver
   129 score4.py            connect four/four-in-a-row
    80 sieve.py             prime number sieves
   192 sha.py               SHA-1 algorithm                 shedskin -l sha
    92 sokoban.py           sokoban solver
   102 solitaire.py         solitaire encryption algorithm
   200 stereo.py            stereo computer vision          shedskin -web stereo && make; python stereo_main.py
   139 sudoku1.py           sudoku solver
   148 sudoku2.py           sudoku solver
   155 sudoku3.py           sudoku solver
    68 sudoku4.py           norvig's sudoku solver
    74 sudoku5.py           dancing links sudoku solver
   280 sunfish.py           chess engine
   113 tictactoe.py         tictactoe on large boards
   651 timsort.py           advanced sorting algorithm
   883 TarsaLZP.py          data compression algorithm
   753 TonyJpegDecoder.py   jpeg decoder
    39 voronoi.py           textual voronoi
   526 voronoi2.py          voronoi algoritm
   112 WebServer.py         simple web server
```

If you know of any other interesting examples, please do suggest them in the shedskin discussion group or post an [issue](https://github.com/shedskin/shedskin/issues/new/choose) in the [Shedskin repo](https://github.com/shedskin/shedskin).


## Building and Running the Examples

Each example has its own directory which should contain the python code to be translated as well as related data files.

Shedskin has the option to build and run 'restricted' python as an executable or as an extension, you can do this manually or automatically via the example runner.

### A. Build/Run Examples Manually

1. **The Builtin way**

   This uses shedskin builtin `Makefile` generation capability. 

   For individual examples, basically `cd` into the example's directory,
   then use the typical `shedskin` workflow as below:

   ```
   shedskin [options] <module> -> translated .cpp and .hpp files
                               -> Makefile

   make                        -> executable or python extension
   ```

   See the [Example Overview](#example-overview) section for guidance on exceptional cases.

2. **The Cmake way**

   It is also possible to build all of the examples using `cmake`:

   ```bash
   mkdir build && cd build && cmake .. && cmake --build .
   ```

### B. Build/Run Examples Automatically

The `./run.py` script in the `examples` directory is also provided 
to automate the manual build/run processes given above.

It has the following commandline interface:

```bash
% ./run.py --help
usage: run [-h] [-b BUILD_TYPE] [-c] [-d] [-e] [-g GENERATOR] [-i PATTERN]
           [-j N] [-k] [-m] [-n] [-p] [-r TEST] [-s] [-t TARGET [TARGET ...]]
           [-x] [--ccache] [--progress] [--reset] [--conan] [--spm] [--cpm]
           [--external-project] [--debug]

runs shedskin tests and examples

options:
  -h, --help            show this help message and exit
  -b BUILD_TYPE, --build-type BUILD_TYPE
                        set cmake build type
  -c, --cmake           run tests using cmake
  -d, --dryrun          dryrun without any changes
  -e, --extension       include python extension tests
  -g GENERATOR, --generator GENERATOR
                        specify a cmake build system generator
  -i PATTERN, --include PATTERN
                        provide regex of tests to include with cmake
  -j N, --parallel N    build and run tests in parallel using N jobs
  -k, --check           check testfile py syntax before running
  -m, --modified        run only recently modified test
  -n, --nocleanup       do not cleanup built test
  -p, --pytest          run pytest before each test run
  -r TEST, --run TEST   run single test
  -s, --stoponfail      stop when first failure happens in ctest
  -t TARGET [TARGET ...], --target TARGET [TARGET ...]
                        build only specified targets
  -x, --run-errs        run error/warning message tests
  --ccache              enable ccache with cmake
  --progress            enable short progress output from ctest
  --reset               reset cmake build
  --conan               install dependencies with conan
  --spm                 install dependencies with spm
  --external-project    install dependencies with externalproject
  --debug               set cmake debug on
```

#### 1. Builtin Method

To build and run a single example in cpp-executable mode:

```bash
    ./run -r <name>.py
```

To build and run a single example in python-extension mode:

```bash
    ./run -er <name>.py
```

To build and run all examples in cpp-executable mode:

```bash
    ./run.py
```

To build and run all examples in python-extension mode:

```bash
    ./run.py -e
```

#### 2. CMake Method

To build and run an example using cmake:

```bash
    ./run.py -c -r pystone
```


To build and run all examples using cmake:

```bash
    ./run.py -c
```

If the above command is run for the first time, it will run the equivalent of the following:

```bash
    mkdir build && cd build && cmake .. && cmake --build .
```

If it is run subsequently, it will run the equivalent of the following:

```bash
    cd build && cmake .. && cmake --build .
```

This is useful during example development and has the benefit of only picking up
changes to modified examples and will not re-translate or re-compile unchanged examples.

To reset or remove the cmake `build` directory and run cmake:

```bash
    ./run.py --reset -c
```

## Optimization and Performance Tips

### Running Build Jobs in Parallel

The cmake method has an option to build and run tests as parallel jobs. This can greatly speed up test runs.

You can specify the number of jobs to build and run tests in parallel:

```bash
./run.py -c -j 4
```

### Using a Different Build System with CMake

Another option is to use a different build system designed for speed like [Ninja](https://ninja-build.org) which automatically maximizes its use of available cores on your system.

If you have `Ninja` installed, you can have cmake use it as your underlying build system and automatically get improved performance vs the default Make-based system:

```bash
./run.py -c -gNinja
```

### Optimizing Running Examples with Cmake

`shedskin -b` disables index-out-of-bounds checking which often improves performance. See the documentation for more performance tips:

https://shedskin.readthedocs.io/


